<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sophie — AI Sales Intelligence Agent | Mantyl</title>
<meta name="description" content="Talk to Sophie, your AI sales intelligence agent. Upload context, have a live conversation, get a signal report and follow-up — in minutes."/>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 44'%3E%3Cdefs%3E%3ClinearGradient id='a' x1='0%25' y1='100%25' x2='50%25' y2='0%25'%3E%3Cstop offset='0%25' stop-color='%235A79CA'/%3E%3Cstop offset='100%25' stop-color='%238B6DB3'/%3E%3C/linearGradient%3E%3ClinearGradient id='b' x1='50%25' y1='100%25' x2='100%25' y2='0%25'%3E%3Cstop offset='0%25' stop-color='%23C06E85'/%3E%3Cstop offset='100%25' stop-color='%23D4856A'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M4 38 L18 6 L26 30 Z' fill='url(%23a)' opacity='.85'/%3E%3Cpath d='M22 30 L30 6 L44 38 Z' fill='url(%23b)' opacity='.75'/%3E%3C/svg%3E"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<style>
:root {
  --navy:#0f172a; --navy-l:#1e293b; --navy-ll:#334155;
  --blue:#6B8ADB; --blue-d:#5A79CA; --lav:#9B7FC7; --rose:#D4849A; --peach:#E89E6C; --orange:#D4956A;
  --grad:linear-gradient(135deg,#6B8ADB 0%,#9B7FC7 33%,#D4849A 66%,#E89E6C 100%);
  --grad-warm:linear-gradient(135deg,#D4849A,#E89E6C,#EEC4A4);
  --font:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;
  --r:12px; --r-lg:20px; --r-xl:32px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;-webkit-font-smoothing:antialiased;scroll-behavior:smooth}
body{font-family:var(--font);color:var(--navy);background:#fff;min-height:100vh}
#root{min-height:100vh;display:flex;flex-direction:column}

/* ─── HEADER ─── */
.hdr{background:var(--navy);height:56px;padding:0 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.hdr::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--grad);opacity:.7}
.hdr-l{display:flex;align-items:center;gap:14px}
.hdr-l a{display:flex;align-items:center;text-decoration:none}
.hdr-div{width:1px;height:20px;background:rgba(255,255,255,.1)}
.hdr-name{color:rgba(255,255,255,.85);font-size:13px;font-weight:500}
.hdr-r{display:flex;align-items:center;gap:10px}
.hdr-pill{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;background:rgba(107,138,219,.1);border:1px solid rgba(107,138,219,.18);border-radius:16px;font-size:10px;font-weight:600;color:var(--blue);text-transform:uppercase;letter-spacing:.04em}
.hdr-dot{width:5px;height:5px;border-radius:50%;background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.5);animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.hdr-cta{padding:6px 16px;background:var(--grad);color:#fff;border:none;border-radius:8px;font-size:11px;font-weight:600;text-decoration:none;font-family:var(--font);cursor:pointer;transition:transform .15s,box-shadow .15s}
.hdr-cta:hover{transform:translateY(-1px);box-shadow:0 3px 12px rgba(107,138,219,.3)}

/* ─── HERO — PREMIUM MARKETING ─── */
.hero{background:var(--navy);position:relative;overflow:hidden;padding:0}
.hero::before{content:'';position:absolute;inset:0;background:
  radial-gradient(ellipse 80% 60% at 70% 50%,rgba(107,138,219,.18) 0%,transparent 60%),
  radial-gradient(ellipse 60% 80% at 30% 80%,rgba(155,127,199,.12) 0%,transparent 55%),
  radial-gradient(ellipse 50% 50% at 80% 20%,rgba(212,132,154,.1) 0%,transparent 50%);pointer-events:none}
.hero-wrap{max-width:1140px;margin:0 auto;display:grid;grid-template-columns:1.1fr .9fr;min-height:480px;position:relative;z-index:1}

/* Left text */
.hero-left{display:flex;flex-direction:column;justify-content:center;padding:60px 48px 60px 36px;position:relative;z-index:2}
.hero-eyebrow{display:inline-flex;align-items:center;gap:7px;margin-bottom:22px;width:fit-content}
.hero-tag{display:inline-flex;align-items:center;gap:6px;padding:5px 14px;background:rgba(107,138,219,.06);border:1px solid rgba(107,138,219,.12);border-radius:20px;font-size:10px;font-weight:700;color:var(--blue);letter-spacing:.06em;text-transform:uppercase}
.hero-tag-dot{width:6px;height:6px;border-radius:50%;background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.6);animation:blink 2s infinite}
.hero-h1{font-size:50px;font-weight:900;color:#fff;line-height:1.08;letter-spacing:-1.5px;margin-bottom:18px}
.hero-h1 em{font-style:normal;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-p{font-size:16px;color:#94a3b8;line-height:1.7;max-width:440px;margin-bottom:32px}
.hero-stats{display:flex;gap:28px}
.hero-stat{display:flex;flex-direction:column;padding:12px 0;border-top:2px solid rgba(107,138,219,.2)}
.hero-stat-num{font-size:26px;font-weight:800;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero-stat-label{font-size:11px;color:#64748b;font-weight:500;margin-top:4px}

/* Right — Sophie showcase */
.hero-right{position:relative;display:flex;align-items:center;justify-content:center;padding:32px 0}

/* Sophie container with brand gradient background */
.sophie-showcase{position:relative;display:flex;align-items:flex-end;justify-content:center}
.sophie-bg{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:360px;height:360px;border-radius:50%;background:radial-gradient(circle at 40% 40%,
  rgba(107,138,219,.4) 0%,
  rgba(155,127,199,.35) 25%,
  rgba(212,132,154,.3) 50%,
  rgba(232,158,108,.2) 75%,
  transparent 100%);filter:blur(40px);animation:glow-breathe 6s ease-in-out infinite}
.sophie-ring{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:300px;height:300px;border-radius:50%;border:1.5px solid rgba(107,138,219,.15);animation:ring-pulse 4s ease-in-out infinite}
.sophie-ring-2{position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:380px;height:380px;border-radius:50%;border:1px solid rgba(155,127,199,.08);animation:ring-pulse 4s ease-in-out infinite 1s}
@keyframes ring-pulse{0%,100%{opacity:.5;transform:translateX(-50%) scale(1)}50%{opacity:1;transform:translateX(-50%) scale(1.03)}}
@keyframes glow-breathe{0%,100%{transform:translateX(-50%) scale(1);opacity:.7}50%{transform:translateX(-50%) scale(1.08);opacity:1}}

/* Sophie image */
.sophie-img{width:340px;height:auto;position:relative;z-index:2;object-fit:contain;display:block;filter:drop-shadow(0 24px 48px rgba(0,0,0,.35)) drop-shadow(0 8px 16px rgba(107,138,219,.15));image-rendering:high-quality}

/* Floating insight cards */
.insight-card{position:absolute;z-index:3;padding:9px 16px;background:rgba(15,23,42,.88);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.06);border-radius:14px;display:flex;align-items:center;gap:9px;animation:card-float 5s ease-in-out infinite;box-shadow:0 12px 32px rgba(0,0,0,.3),0 0 0 1px rgba(255,255,255,.03) inset}
.insight-card svg{flex-shrink:0}
.insight-card-text{font-size:11px;font-weight:600;color:rgba(255,255,255,.9);white-space:nowrap}
.insight-card-sub{font-size:9px;color:#64748b;margin-top:2px;font-weight:400}
.ic-1{top:14%;right:4%;animation-delay:0s}
.ic-2{top:48%;left:0%;animation-delay:1.8s}
.ic-3{bottom:14%;right:8%;animation-delay:3.2s}
@keyframes card-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}

/* Ambient particles */
.hero-particle{position:absolute;border-radius:50%;pointer-events:none;z-index:0}
.hp-1{width:4px;height:4px;background:var(--blue);top:20%;left:15%;opacity:.4;animation:float-p 8s ease-in-out infinite}
.hp-2{width:3px;height:3px;background:var(--lav);top:60%;left:8%;opacity:.3;animation:float-p 10s ease-in-out infinite 2s}
.hp-3{width:5px;height:5px;background:var(--rose);top:30%;right:15%;opacity:.3;animation:float-p 9s ease-in-out infinite 4s}
.hp-4{width:3px;height:3px;background:var(--peach);top:70%;right:20%;opacity:.35;animation:float-p 7s ease-in-out infinite 1s}
.hp-5{width:4px;height:4px;background:var(--blue);bottom:25%;left:20%;opacity:.25;animation:float-p 11s ease-in-out infinite 3s}
.hp-6{width:3px;height:3px;background:var(--lav);top:15%;right:35%;opacity:.2;animation:float-p 12s ease-in-out infinite 5s}
@keyframes float-p{0%,100%{transform:translate(0,0)}25%{transform:translate(10px,-15px)}50%{transform:translate(-5px,-25px)}75%{transform:translate(15px,-10px)}}

/* Subtle grid */
.hero-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,.02) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.02) 1px,transparent 1px);background-size:64px 64px;mask-image:radial-gradient(ellipse 60% 60% at 50% 50%,black,transparent);-webkit-mask-image:radial-gradient(ellipse 60% 60% at 50% 50%,black,transparent)}

/* Bottom gradient fade to white */
.hero-fade{position:absolute;bottom:0;left:0;right:0;height:80px;background:linear-gradient(to bottom,transparent,rgba(15,23,42,.8));z-index:1;pointer-events:none}

/* ─── STEPS ─── */
.steps{display:flex;align-items:center;justify-content:center;gap:0;padding:14px 28px;background:#fff;border-bottom:1px solid #e2e8f0;position:sticky;top:56px;z-index:90}
.step{display:flex;align-items:center;gap:7px;font-size:12px;font-weight:500;color:#94a3b8;transition:.3s}
.step.on{color:var(--blue);font-weight:600}
.step.done{color:#22c55e}
.step-n{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;background:#f1f5f9;color:#94a3b8;transition:.3s}
.step.on .step-n{background:var(--blue);color:#fff}
.step.done .step-n{background:#22c55e;color:#fff}
.step-line{width:40px;height:2px;background:#e2e8f0;margin:0 10px;transition:.3s}
.step-line.dn{background:#22c55e}

/* ─── MAIN ─── */
.mn{flex:1;padding:28px;max-width:840px;margin:0 auto;width:100%}
.mn.wide{max-width:960px}

/* ─── FORM ─── */
.card{background:#fff;border:1px solid #e2e8f0;border-radius:var(--r-lg);padding:24px;margin-bottom:18px;box-shadow:0 1px 3px rgba(15,23,42,.04);transition:box-shadow .2s}
.card:hover{box-shadow:0 4px 14px rgba(15,23,42,.07)}
.card-t{font-size:14px;font-weight:600;color:var(--navy);margin-bottom:18px;display:flex;align-items:center;gap:9px;padding-bottom:12px;border-bottom:1px solid #f1f5f9}
.card-t svg{flex-shrink:0}
.fg{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.fi{display:flex;flex-direction:column;gap:5px}
.fi.fw{grid-column:1/-1}
.fi label{font-size:12px;font-weight:500;color:var(--navy-ll);display:flex;align-items:center;gap:3px}
.req{color:#ef4444;font-weight:700;font-size:13px}
.fi input,.fi select,.fi textarea{padding:9px 13px;border:1px solid #e2e8f0;border-radius:8px;font-family:var(--font);font-size:13px;color:var(--navy);background:#fff;outline:none;transition:.15s}
.fi input:focus,.fi select:focus,.fi textarea:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(107,138,219,.08)}
.fi input::placeholder,.fi textarea::placeholder{color:#94a3b8}
.fi.err input,.fi.err select,.fi.err textarea{border-color:#ef4444;box-shadow:0 0 0 3px rgba(239,68,68,.06)}
.ferr{font-size:10px;color:#ef4444;font-weight:500}

/* Upload */
.uz{border:2px dashed #cbd5e1;border-radius:var(--r);padding:24px;text-align:center;cursor:pointer;transition:.2s;background:#fafbfc}
.uz:hover,.uz.dg{border-color:var(--blue);background:rgba(107,138,219,.02)}
.uz svg{margin-bottom:6px}
.uz-t{font-size:13px;color:var(--navy-ll);font-weight:500}
.uz-h{font-size:11px;color:#94a3b8;margin-top:3px}
.uf{margin-top:10px;display:flex;flex-direction:column;gap:5px}
.uf-i{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#fff;border:1px solid #e2e8f0;border-radius:8px;font-size:12px}
.uf-n{flex:1;font-weight:500;color:var(--navy);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.uf-s{font-size:10px;color:#94a3b8}
.uf-x{background:none;border:none;cursor:pointer;color:#cbd5e1;display:flex;transition:.15s}
.uf-x:hover{color:#ef4444}

/* Start */
.go-btn{display:flex;align-items:center;justify-content:center;gap:9px;width:100%;padding:13px 24px;background:var(--grad);color:#fff;border:none;border-radius:var(--r);font-family:var(--font);font-size:15px;font-weight:600;cursor:pointer;transition:.2s;box-shadow:0 4px 18px rgba(107,138,219,.22)}
.go-btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 6px 28px rgba(107,138,219,.32)}
.go-btn:disabled{opacity:.45;cursor:not-allowed}
.go-btn svg{flex-shrink:0}

/* ─── VOICE SESSION — IMMERSIVE AI INTERFACE ─── */
.vs{display:flex;flex-direction:column;min-height:80vh;background:var(--navy);border-radius:var(--r-xl);overflow:hidden;position:relative;margin:-28px;padding:0}

/* Session dark background with layered gradient — inspired by Apple Intelligence / Siri */
.vs::before{content:'';position:absolute;inset:0;background:
  radial-gradient(ellipse 70% 50% at 50% 30%,rgba(107,138,219,.15) 0%,transparent 60%),
  radial-gradient(ellipse 50% 60% at 30% 70%,rgba(155,127,199,.1) 0%,transparent 55%),
  radial-gradient(ellipse 40% 40% at 75% 60%,rgba(212,132,154,.08) 0%,transparent 50%);
  pointer-events:none;z-index:0}

/* Top bar with Sophie branding inside session */
.vs-header{display:flex;align-items:center;justify-content:space-between;padding:20px 28px;position:relative;z-index:5}
.vs-header-left{display:flex;align-items:center;gap:10px}
.vs-header-name{font-size:13px;font-weight:600;color:rgba(255,255,255,.85);letter-spacing:-.2px}
.vs-header-tag{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;background:rgba(107,138,219,.08);border:1px solid rgba(107,138,219,.12);border-radius:16px;font-size:9px;font-weight:700;color:var(--blue);text-transform:uppercase;letter-spacing:.05em}
.vs-header-dot{width:5px;height:5px;border-radius:50%;background:#22c55e;box-shadow:0 0 6px rgba(34,197,94,.5);animation:blink 2s infinite}

/* Main session layout — Sophie left, conversation right */
.vs-body{display:grid;grid-template-columns:.42fr .58fr;flex:1;position:relative;z-index:2;min-height:0}

/* Left — Sophie visual with animated orb */
.vs-left{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px;position:relative}

/* The animated gradient orb behind Sophie — Siri/Apple Intelligence inspired */
.ai-orb-container{position:relative;width:280px;height:280px;display:flex;align-items:center;justify-content:center}

/* Main gradient blob — morphs shape when active */
.ai-orb{position:absolute;inset:0;border-radius:50%;background:conic-gradient(from 0deg,
  rgba(107,138,219,.6),
  rgba(155,127,199,.5),
  rgba(212,132,154,.5),
  rgba(232,158,108,.4),
  rgba(107,138,219,.6));
  filter:blur(45px);opacity:.4;animation:orb-idle 8s ease-in-out infinite;transition:opacity .6s,filter .6s}

/* Listening state — orb intensifies, pulses faster */
.ai-orb.li{opacity:.75;filter:blur(35px);animation:orb-listen 1.5s ease-in-out infinite}

/* Speaking state — orb expands/contracts dynamically */
.ai-orb.sp{opacity:.8;filter:blur(30px);animation:orb-speak 2s ease-in-out infinite}

/* Thinking state — slow rotation */
.ai-orb.th{opacity:.55;filter:blur(40px);animation:orb-think 3s linear infinite}

@keyframes orb-idle{
  0%,100%{transform:scale(1) rotate(0deg);border-radius:50%}
  25%{transform:scale(1.03) rotate(90deg);border-radius:48% 52% 50% 50%}
  50%{transform:scale(.97) rotate(180deg);border-radius:50% 48% 52% 50%}
  75%{transform:scale(1.02) rotate(270deg);border-radius:52% 50% 48% 50%}
}
@keyframes orb-listen{
  0%,100%{transform:scale(1) rotate(0deg);opacity:.7}
  25%{transform:scale(1.12) rotate(45deg);opacity:.85}
  50%{transform:scale(.95) rotate(90deg);opacity:.7}
  75%{transform:scale(1.15) rotate(135deg);opacity:.9}
}
@keyframes orb-speak{
  0%,100%{transform:scale(1) rotate(0deg);border-radius:50%}
  15%{transform:scale(1.18) rotate(30deg);border-radius:45% 55% 50% 50%}
  30%{transform:scale(.92) rotate(60deg);border-radius:55% 45% 48% 52%}
  45%{transform:scale(1.14) rotate(100deg);border-radius:48% 52% 55% 45%}
  60%{transform:scale(.96) rotate(140deg);border-radius:52% 48% 45% 55%}
  75%{transform:scale(1.1) rotate(180deg);border-radius:50% 50% 52% 48%}
}
@keyframes orb-think{
  0%{transform:rotate(0deg) scale(1)}
  100%{transform:rotate(360deg) scale(1)}
}

/* Secondary inner glow ring */
.ai-orb-inner{position:absolute;inset:30px;border-radius:50%;background:conic-gradient(from 180deg,
  rgba(107,138,219,.3),
  rgba(155,127,199,.25),
  rgba(212,132,154,.3),
  rgba(232,158,108,.25),
  rgba(107,138,219,.3));
  filter:blur(25px);opacity:.3;animation:orb-inner-spin 12s linear infinite reverse;transition:opacity .6s}
.ai-orb.li~.ai-orb-inner,.ai-orb.sp~.ai-orb-inner{opacity:.6}
@keyframes orb-inner-spin{to{transform:rotate(360deg)}}

/* Pulsing rings — like Siri's ripple effect */
.ai-pulse-ring{position:absolute;inset:-15px;border-radius:50%;border:1.5px solid rgba(107,138,219,.08);opacity:0;transition:opacity .4s}
.ai-pulse-ring.r2{inset:-35px;border-color:rgba(155,127,199,.06)}
.ai-pulse-ring.r3{inset:-55px;border-color:rgba(212,132,154,.04)}
.vs-left.active .ai-pulse-ring{opacity:1;animation:pulse-expand 2.5s ease-out infinite}
.vs-left.active .ai-pulse-ring.r2{animation-delay:.5s}
.vs-left.active .ai-pulse-ring.r3{animation-delay:1s}
@keyframes pulse-expand{0%{transform:scale(.95);opacity:.6}100%{transform:scale(1.15);opacity:0}}

/* Sophie image inside the orb */
.vs-sophie{position:relative;z-index:3;width:180px;height:auto;object-fit:contain;filter:drop-shadow(0 16px 40px rgba(0,0,0,.4));transition:transform .4s}
.vs-left.speaking .vs-sophie{animation:sophie-bob 2s ease-in-out infinite}
@keyframes sophie-bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

/* Status text below Sophie */
.vs-status{margin-top:24px;display:flex;align-items:center;gap:8px;font-size:12px;font-weight:500;color:rgba(255,255,255,.5);position:relative;z-index:3}
.vs-status-dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,.2);transition:.3s}
.vs-status-dot.idle{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.4)}
.vs-status-dot.listening{background:var(--blue);box-shadow:0 0 8px rgba(107,138,219,.5);animation:blink 1s infinite}
.vs-status-dot.speaking{background:var(--rose);box-shadow:0 0 8px rgba(212,132,154,.5);animation:blink 1.5s infinite}
.vs-status-dot.thinking{background:var(--lav);box-shadow:0 0 8px rgba(155,127,199,.5);animation:blink .8s infinite}

/* Waveform visualizer below Sophie */
.vs-wave{display:flex;align-items:center;gap:2px;height:32px;margin-top:16px;position:relative;z-index:3}
.vs-wave-bar{width:3px;border-radius:2px;height:6px;transition:height .08s;background:linear-gradient(to top,var(--blue),var(--lav))}
.vs-wave-bar.active{animation:wave-dance .4s ease-in-out infinite alternate}
.vs-wave-bar:nth-child(1){animation-delay:0s}.vs-wave-bar:nth-child(2){animation-delay:.04s}
.vs-wave-bar:nth-child(3){animation-delay:.08s}.vs-wave-bar:nth-child(4){animation-delay:.12s}
.vs-wave-bar:nth-child(5){animation-delay:.16s}.vs-wave-bar:nth-child(6){animation-delay:.2s}
.vs-wave-bar:nth-child(7){animation-delay:.24s}.vs-wave-bar:nth-child(8){animation-delay:.28s}
.vs-wave-bar:nth-child(9){animation-delay:.24s}.vs-wave-bar:nth-child(10){animation-delay:.2s}
.vs-wave-bar:nth-child(11){animation-delay:.16s}.vs-wave-bar:nth-child(12){animation-delay:.12s}
.vs-wave-bar:nth-child(13){animation-delay:.08s}
@keyframes wave-dance{0%{height:4px;opacity:.4}100%{height:28px;opacity:1}}

/* Right — Conversation panel */
.vs-right{display:flex;flex-direction:column;padding:0 28px 24px 12px;min-height:0}

/* Transcript area */
.vs-transcript{flex:1;overflow-y:auto;padding:16px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);border-radius:var(--r-lg);margin-bottom:16px;min-height:200px}
.vs-transcript::-webkit-scrollbar{width:4px}
.vs-transcript::-webkit-scrollbar-track{background:transparent}
.vs-transcript::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:4px}
.vs-tx-empty{text-align:center;color:rgba(255,255,255,.2);font-size:12px;padding:40px 0}

/* Message bubbles */
.vs-msg{margin-bottom:12px;display:flex;gap:10px;animation:msg-in .35s ease}
@keyframes msg-in{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.vs-msg-avatar{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;margin-top:2px}
.vs-msg-avatar.sophie{background:linear-gradient(135deg,var(--blue),var(--lav));color:#fff;overflow:hidden}
.vs-msg-avatar.sophie img{width:100%;height:100%;object-fit:cover}
.vs-msg-avatar.user{background:rgba(255,255,255,.08);color:rgba(255,255,255,.6)}
.vs-msg-body{flex:1}
.vs-msg-name{font-size:9px;font-weight:600;color:rgba(255,255,255,.35);text-transform:uppercase;letter-spacing:.05em;margin-bottom:3px}
.vs-msg-text{font-size:13px;line-height:1.65;color:rgba(255,255,255,.85)}
.vs-msg.sophie-msg .vs-msg-text{color:rgba(255,255,255,.92)}

/* Thinking indicator */
.vs-thinking{display:flex;align-items:center;gap:7px;font-size:12px;color:rgba(255,255,255,.4);padding:4px 0}
.thk-dots{display:flex;gap:3px}
.thk-dots span{width:5px;height:5px;border-radius:50%;background:var(--lav);animation:dp 1.2s infinite}
.thk-dots span:nth-child(2){animation-delay:.15s}
.thk-dots span:nth-child(3){animation-delay:.3s}
@keyframes dp{0%,100%{opacity:.3;transform:scale(.8)}50%{opacity:1;transform:scale(1.3)}}

/* Controls bar */
.vs-controls{display:flex;align-items:center;gap:16px;padding:18px 20px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);border-radius:var(--r);justify-content:center;flex-direction:column}
.vs-controls-row{display:flex;align-items:center;gap:16px;justify-content:center;width:100%}

/* Mic button — large, prominent */
.mic-btn{width:56px;height:56px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.25s;position:relative;overflow:hidden;flex-shrink:0}
.mic-btn.idle{background:var(--grad);color:#fff;box-shadow:0 4px 20px rgba(107,138,219,.3)}
.mic-btn.idle:hover{transform:scale(1.06);box-shadow:0 6px 28px rgba(107,138,219,.4)}
.mic-btn.recording{background:#ef4444;color:#fff;box-shadow:0 4px 20px rgba(239,68,68,.4);animation:mic-glow 1.5s ease-in-out infinite}
@keyframes mic-glow{0%,100%{box-shadow:0 4px 20px rgba(239,68,68,.4)}50%{box-shadow:0 6px 36px rgba(239,68,68,.6)}}
.mic-btn svg{width:22px;height:22px;stroke:currentColor;fill:none;stroke-width:2;position:relative;z-index:1}
.mic-btn:disabled{opacity:.4;cursor:not-allowed}

/* Mic label — guides user to press to talk */
.mic-label{font-size:12px;font-weight:500;color:rgba(255,255,255,.5);text-align:center;letter-spacing:.01em;line-height:1.4;max-width:120px}
.mic-label strong{color:rgba(255,255,255,.75);font-weight:600}
.mic-label.recording-label{color:rgba(239,68,68,.7)}
.mic-label.recording-label strong{color:#fca5a5}

/* End session button — prominent so user knows to exit */
.end-btn{padding:10px 20px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:8px;font-family:var(--font);font-size:12px;font-weight:500;color:rgba(255,255,255,.45);cursor:pointer;transition:.2s;display:flex;align-items:center;gap:6px}
.end-btn:hover{background:rgba(239,68,68,.08);border-color:rgba(239,68,68,.2);color:#fca5a5}
.end-btn svg{width:13px;height:13px;stroke:currentColor;fill:none;stroke-width:2}

/* Session exit hint — tells user to press End when done */
.vs-exit-hint{display:flex;align-items:center;justify-content:center;gap:6px;font-size:11px;color:rgba(255,255,255,.28);padding:0;margin-top:2px}
.vs-exit-hint svg{width:11px;height:11px;stroke:currentColor;fill:none;stroke-width:2;opacity:.5}

/* Divider between text input and voice */
.vs-input-divider{display:flex;align-items:center;gap:10px;margin-top:14px;margin-bottom:2px}
.vs-input-divider-line{flex:1;height:1px;background:rgba(255,255,255,.06)}
.vs-input-divider-text{font-size:10px;font-weight:500;color:rgba(255,255,255,.2);text-transform:uppercase;letter-spacing:.06em}

/* Text input */
.vs-input{display:flex;gap:8px}
.vs-input input{flex:1;padding:11px 16px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);border-radius:8px;font-family:var(--font);font-size:13px;color:rgba(255,255,255,.85);outline:none;transition:.2s}
.vs-input input::placeholder{color:rgba(255,255,255,.18)}
.vs-input input:focus{border-color:rgba(107,138,219,.3);box-shadow:0 0 0 3px rgba(107,138,219,.06);background:rgba(255,255,255,.06)}
.vs-input button{padding:11px 18px;background:var(--grad);color:#fff;border:none;border-radius:8px;font-family:var(--font);font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:5px;transition:.2s}
.vs-input button:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(107,138,219,.3)}
.vs-input button:disabled{opacity:.3;cursor:not-allowed;transform:none;box-shadow:none}
.vs-input button svg{width:13px;height:13px;stroke:currentColor;fill:none;stroke-width:2}

/* Floating ambient particles inside session */
.vs-particle{position:absolute;border-radius:50%;pointer-events:none;z-index:1}
.vp-1{width:3px;height:3px;background:var(--blue);top:15%;right:20%;opacity:.15;animation:float-p 10s ease-in-out infinite}
.vp-2{width:2px;height:2px;background:var(--lav);bottom:20%;left:15%;opacity:.12;animation:float-p 14s ease-in-out infinite 3s}
.vp-3{width:4px;height:4px;background:var(--rose);top:40%;right:10%;opacity:.1;animation:float-p 12s ease-in-out infinite 6s}
.vp-4{width:2px;height:2px;background:var(--peach);bottom:30%;right:35%;opacity:.12;animation:float-p 9s ease-in-out infinite 2s}

/* ─── DEBRIEF — EXECUTIVE DASHBOARD ─── */
.db{max-width:920px;margin:0 auto;padding-bottom:24px}

/* Debrief hero / executive header */
.db-hero{background:var(--navy);border-radius:var(--r-xl);padding:36px 40px 32px;margin-bottom:24px;position:relative;overflow:hidden}
.db-hero::before{content:'';position:absolute;inset:0;background:
  radial-gradient(ellipse 60% 50% at 80% 20%,rgba(107,138,219,.15) 0%,transparent 60%),
  radial-gradient(ellipse 40% 60% at 20% 80%,rgba(155,127,199,.1) 0%,transparent 55%);pointer-events:none}
.db-hero-top{display:flex;align-items:flex-start;justify-content:space-between;position:relative;z-index:1;margin-bottom:28px}
.db-hero-title{font-size:24px;font-weight:800;color:#fff;letter-spacing:-.5px;line-height:1.2}
.db-hero-title em{font-style:normal;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.db-hero-sub{font-size:13px;color:#64748b;margin-top:6px;font-weight:400}
.db-hero-actions{display:flex;gap:8px}
.db-hero-btn{padding:8px 18px;border-radius:8px;font-family:var(--font);font-size:12px;font-weight:600;cursor:pointer;transition:.2s;display:flex;align-items:center;gap:6px;border:none}
.db-hero-btn.primary{background:var(--grad);color:#fff;box-shadow:0 4px 14px rgba(107,138,219,.25)}
.db-hero-btn.primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(107,138,219,.35)}
.db-hero-btn.secondary{background:rgba(255,255,255,.06);color:rgba(255,255,255,.6);border:1px solid rgba(255,255,255,.1)}
.db-hero-btn.secondary:hover{background:rgba(255,255,255,.1);color:rgba(255,255,255,.85)}
.db-hero-btn svg{width:13px;height:13px;stroke:currentColor;fill:none;stroke-width:2}

/* Session metadata grid */
.db-meta{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;position:relative;z-index:1}
.db-meta-item{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px 16px}
.db-meta-label{font-size:10px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.06em;margin-bottom:6px}
.db-meta-value{font-size:14px;font-weight:600;color:rgba(255,255,255,.9);line-height:1.3}
.db-meta-value.sm{font-size:12px;font-weight:500}

/* Risk badge */
.risk-badge{display:inline-flex;align-items:center;gap:6px;padding:5px 14px;border-radius:20px;font-size:12px;font-weight:700;letter-spacing:.03em;text-transform:uppercase}
.risk-badge.green{background:rgba(34,197,94,.12);color:#22c55e;border:1px solid rgba(34,197,94,.2)}
.risk-badge.yellow{background:rgba(234,179,8,.12);color:#eab308;border:1px solid rgba(234,179,8,.2)}
.risk-badge.red{background:rgba(239,68,68,.12);color:#ef4444;border:1px solid rgba(239,68,68,.2)}
.risk-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.risk-badge.green .risk-dot{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.5)}
.risk-badge.yellow .risk-dot{background:#eab308;box-shadow:0 0 8px rgba(234,179,8,.5)}
.risk-badge.red .risk-dot{background:#ef4444;box-shadow:0 0 8px rgba(239,68,68,.5)}

/* Section cards */
.db-section{background:#fff;border:1px solid #e2e8f0;border-radius:16px;overflow:hidden;margin-bottom:20px;box-shadow:0 1px 3px rgba(15,23,42,.03),0 4px 12px rgba(15,23,42,.02);transition:box-shadow .2s}
.db-section:hover{box-shadow:0 2px 6px rgba(15,23,42,.05),0 8px 24px rgba(15,23,42,.04)}

/* Section with colored left accent */
.db-section.accent-blue{border-left:4px solid var(--blue)}
.db-section.accent-lav{border-left:4px solid var(--lav)}
.db-section.accent-rose{border-left:4px solid var(--rose)}
.db-section.accent-navy{border-left:4px solid var(--navy-ll)}

/* Section header */
.db-sh{padding:18px 24px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #f1f5f9}
.db-sh-left{display:flex;align-items:center;gap:12px}
.db-sh-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.db-sh-icon.blue{background:rgba(107,138,219,.08);color:var(--blue)}
.db-sh-icon.lav{background:rgba(155,127,199,.08);color:var(--lav)}
.db-sh-icon.rose{background:rgba(212,132,154,.08);color:var(--rose)}
.db-sh-icon.navy{background:rgba(15,23,42,.05);color:var(--navy-ll)}
.db-sh-text h3{font-size:15px;font-weight:700;color:var(--navy);letter-spacing:-.2px}
.db-sh-text p{font-size:11px;color:#94a3b8;margin-top:2px;font-weight:400}
.db-sh-right{display:flex;gap:6px}

/* Copy button refined */
.cp{padding:6px 14px;background:#fff;border:1px solid #e2e8f0;border-radius:8px;font-family:var(--font);font-size:11px;font-weight:500;color:#94a3b8;cursor:pointer;transition:.2s;display:flex;align-items:center;gap:5px}
.cp:hover{border-color:var(--blue);color:var(--blue);background:#f8fafc}
.cp.ok{border-color:#22c55e;color:#22c55e;background:rgba(34,197,94,.04)}
.cp svg{width:12px;height:12px;stroke:currentColor;fill:none;stroke-width:2}

/* Section body */
.db-sb{padding:20px 24px 24px}
.db-sb p,.db-sb li{font-size:14px;line-height:1.75;color:var(--navy-l)}
.db-sb strong{color:var(--navy);font-weight:600}

/* Signal findings list */
.db-findings{list-style:none;padding:0;margin:0}
.db-findings li{padding:10px 0;border-bottom:1px solid #f8fafc;display:flex;align-items:flex-start;gap:10px;font-size:13.5px;line-height:1.65;color:var(--navy-l)}
.db-findings li:last-child{border-bottom:none}
.db-findings li::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--blue);flex-shrink:0;margin-top:8px}
.db-diagnosis{margin-top:16px;padding:16px 20px;background:#f8fafc;border-radius:12px;border-left:3px solid var(--blue);font-size:14px;line-height:1.75;color:var(--navy-l)}

/* Numbered next moves */
.db-moves{list-style:none;padding:0;margin:0;counter-reset:move}
.db-moves li{counter-increment:move;padding:14px 0;border-bottom:1px solid #f1f5f9;display:flex;align-items:flex-start;gap:14px;font-size:14px;line-height:1.7;color:var(--navy-l)}
.db-moves li:last-child{border-bottom:none}
.db-moves li::before{content:counter(move);width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--lav),var(--rose));color:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0;margin-top:1px}

/* Email preview */
.db-email{background:#fafbfc;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;margin:0}
.db-email-header{padding:14px 20px;border-bottom:1px solid #e2e8f0;background:#fff}
.db-email-row{display:flex;align-items:center;gap:8px;font-size:12px;margin-bottom:6px}
.db-email-row:last-child{margin-bottom:0}
.db-email-label{font-weight:600;color:#94a3b8;width:60px;flex-shrink:0;text-transform:uppercase;font-size:10px;letter-spacing:.04em}
.db-email-val{font-weight:500;color:var(--navy);font-size:13px}
.db-email-body{padding:20px 24px;font-size:14px;line-height:1.8;color:var(--navy-l);white-space:pre-wrap;word-wrap:break-word;font-family:var(--font)}

/* Transcript section */
.db-transcript{max-height:400px;overflow-y:auto;padding:0}
.db-transcript::-webkit-scrollbar{width:4px}
.db-transcript::-webkit-scrollbar-thumb{background:#e2e8f0;border-radius:4px}
.db-tx-msg{display:flex;gap:12px;padding:14px 24px;border-bottom:1px solid #fafbfc;transition:background .15s}
.db-tx-msg:hover{background:#fafbfc}
.db-tx-msg:last-child{border-bottom:none}
.db-tx-avatar{width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0}
.db-tx-avatar.sophie{background:linear-gradient(135deg,var(--blue),var(--lav));color:#fff;overflow:hidden}
.db-tx-avatar.sophie img{width:100%;height:100%;object-fit:cover}
.db-tx-avatar.user{background:#f1f5f9;color:var(--navy-ll)}
.db-tx-body{flex:1;min-width:0}
.db-tx-name{font-size:11px;font-weight:600;color:var(--navy);margin-bottom:3px}
.db-tx-text{font-size:13px;line-height:1.65;color:var(--navy-l)}

/* Collapsible transcript toggle */
.db-collapse-btn{width:100%;padding:12px;background:#f8fafc;border:none;border-top:1px solid #e2e8f0;font-family:var(--font);font-size:12px;font-weight:500;color:#94a3b8;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;transition:.15s}
.db-collapse-btn:hover{background:#f1f5f9;color:var(--navy-ll)}
.db-collapse-btn svg{width:12px;height:12px;stroke:currentColor;fill:none;stroke-width:2;transition:transform .2s}
.db-collapse-btn.open svg{transform:rotate(180deg)}

/* Action footer */
.db-actions{display:flex;gap:12px;margin-top:8px;padding:20px 0;border-top:1px solid #f1f5f9}
.da-btn{padding:12px 24px;border-radius:10px;font-family:var(--font);font-size:13px;font-weight:600;cursor:pointer;transition:.2s;display:flex;align-items:center;gap:8px;border:none}
.da-btn.primary{background:var(--grad);color:#fff;box-shadow:0 4px 14px rgba(107,138,219,.22)}
.da-btn.primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(107,138,219,.32)}
.da-btn.secondary{background:#fff;color:var(--navy);border:1px solid #e2e8f0}
.da-btn.secondary:hover{background:#f8fafc;border-color:#cbd5e1}
.da-btn svg{width:14px;height:14px;stroke:currentColor;fill:none;stroke-width:2}

/* Loading state for debrief */
.db-loading{text-align:center;padding:80px 24px}
.db-loading-text{font-size:15px;font-weight:500;color:var(--navy-ll);margin-top:20px}
.db-loading-sub{font-size:12px;color:#94a3b8;margin-top:6px}
.db-loading-dots{display:flex;gap:4px;justify-content:center;margin-top:20px}
.db-loading-dots span{width:8px;height:8px;border-radius:50%;background:var(--lav);animation:dp 1.2s infinite}
.db-loading-dots span:nth-child(2){animation-delay:.15s}
.db-loading-dots span:nth-child(3){animation-delay:.3s}

/* ─── CTA ─── */
.cta{padding:18px 24px;background:var(--navy);border-radius:var(--r-lg);display:flex;align-items:center;justify-content:space-between;gap:16px;margin-top:24px}
.cta-l{display:flex;align-items:center;gap:12px}
.cta-m{font-size:16px;font-weight:800;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-tt{font-size:14px;font-weight:600;color:#fff}
.cta-dd{font-size:12px;color:#64748b;margin-top:1px}
.cta-b{padding:9px 20px;background:var(--grad);color:#fff;border:none;border-radius:8px;font-family:var(--font);font-size:12px;font-weight:600;text-decoration:none;cursor:pointer;white-space:nowrap;transition:.2s}
.cta-b:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(107,138,219,.3)}

/* Error */
.err-b{padding:10px 14px;background:#fef2f2;border:1px solid #fecaca;border-radius:8px;margin-bottom:14px;font-size:12px;color:#991b1b;display:flex;align-items:center;gap:7px}
.err-b svg{flex-shrink:0}

/* Footer */
.ft{padding:16px 28px;border-top:1px solid #e2e8f0;text-align:center}
.ft-i{display:flex;align-items:center;justify-content:center;gap:7px;font-size:11px;color:#94a3b8}
.ft-i a{color:var(--blue);text-decoration:none;font-weight:500}

.fi-a{animation:fadeIn .4s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.ld-s{text-align:center;padding:60px 16px}

@media(max-width:768px){
  .hero-wrap{grid-template-columns:1fr;min-height:auto}
  .hero-left{padding:36px 20px 20px;text-align:center;align-items:center}
  .hero-h1{font-size:34px}
  .hero-right{padding:0 0 24px}
  .sophie-img{width:220px}
  .sophie-bg{width:260px;height:260px}
  .sophie-ring,.sophie-ring-2{display:none}
  .insight-card{display:none}
  .hero-particle{display:none}
  .hero-stats{justify-content:center}
  .hero-stat{padding:8px 0}
  .mn{padding:16px}
  .fg{grid-template-columns:1fr}
  .cta{flex-direction:column;text-align:center}
  .db-hero{padding:24px 20px}
  .db-hero-top{flex-direction:column;gap:16px}
  .db-hero-title{font-size:20px}
  .db-meta{grid-template-columns:1fr 1fr;gap:10px}
  .db-sh{padding:14px 16px}
  .db-sb{padding:16px}
  .db-actions{flex-direction:column}
  .vs{margin:-16px;border-radius:0}
  .vs-body{grid-template-columns:1fr;grid-template-rows:auto 1fr}
  .vs-left{padding:16px 16px 0;flex-direction:row;gap:16px;justify-content:center}
  .ai-orb-container{width:140px;height:140px}
  .vs-sophie{width:90px}
  .ai-pulse-ring,.ai-pulse-ring.r2,.ai-pulse-ring.r3{display:none}
  .vs-right{padding:0 16px 16px}
  .vs-transcript{min-height:150px}
  .vs-controls{flex-wrap:wrap}
  .vs-controls-row{flex-wrap:wrap;gap:10px}
  .mic-label{font-size:11px;max-width:100px}
  .vs-exit-hint{font-size:10px;text-align:center}
  .vs-input{flex-direction:column}
}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback}=React;
const CAL='https://calendly.com/jose-mantyl/free-consultation-ai-automation';

// ── SOPHIE IMAGE — uses deployed sophie.png ─────────────────────
const SophiePortrait=({w=340})=>(
<img src="sophie.png" alt="Sophie — AI Sales Intelligence Agent" className="sophie-img" style={{width:w}} />
);

// ── System Prompt ────────────────────────────────────────────────
const SYS=`You are Sophie, a senior sales intelligence analyst built by Mantyl. You speak with confidence, warmth, and directness — like a trusted advisor who's been in the trenches alongside thousands of revenue teams.

Your personality:
- Direct and incisive — you cut through noise and identify what matters
- Warm but no-nonsense — you care about the rep's success but won't sugarcoat
- Proactive — you don't wait for questions, you surface risks and opportunities
- Pattern-aware — you recognize signals from thousands of conversations analyzed

Your approach:
1. LISTEN — let the rep share their situation
2. DIAGNOSE — identify signals: timeline avoidance, stakeholder gaps, competitive mentions, champion strength, budget uncertainty, engagement drop-off
3. CHALLENGE — ask questions the rep hasn't thought to ask
4. PRESCRIBE — specific, actionable next steps with exact language to use
5. FOLLOW THROUGH — draft follow-ups, suggest calendar invites, outline business cases

Never use "deal", "coaching", or "coach". Say "this conversation", "your prospect", "this opportunity", "the engagement", "their buying process".

Be conversational (2-4 sentences). Don't monologue. One pointed question at a time.

At session end, generate:
1. Signal Report — key findings, risk level (GREEN/YELLOW/RED), diagnosis
2. Draft follow-up message
3. Recommended next moves`;

// ── DUAL-MODEL API ──────────────────────────────────────────────
// Voice conversation: OpenAI GPT-4o (fast, natural dialogue)
// Debrief & reports: Claude Haiku (structured output, cost-efficient)
const CHAT_ENDPOINT = '/api/chat';       // → Netlify Function → OpenAI
const DEBRIEF_ENDPOINT = '/api/debrief'; // → Netlify Function → Anthropic
const TTS_ENDPOINT = '/api/tts';         // → Netlify Function → ElevenLabs TTS

// Voice conversation — OpenAI GPT-4o
async function ask(messages) {
  const res = await fetch(CHAT_ENDPOINT, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ model: 'gpt-4o', messages, temperature: .7, max_tokens: 800 })
  });
  if (!res.ok) { const e = await res.json().catch(()=>({})); throw new Error(e.error?.message||`Error ${res.status}`); }
  return (await res.json()).choices[0].message.content;
}

// Debrief generation — Claude Haiku
async function genDebrief(messages) {
  // Convert OpenAI-format messages to Claude format
  // Extract system message and convert the rest
  const systemMsg = messages.find(m => m.role === 'system');
  const chatMsgs = messages.filter(m => m.role !== 'system');

  const debriefPrompt = `Based on the full conversation transcript below, generate a comprehensive executive debrief. Use EXACTLY this format with these section headers (## markers are critical for parsing):

## SIGNAL REPORT
Risk Level: [GREEN or YELLOW or RED]

Key Signals:
- [Signal 1: specific observation from the conversation]
- [Signal 2: specific observation]
- [Signal 3: specific observation]
- [Signal 4: if applicable]
- [Signal 5: if applicable]

Diagnosis: [2-4 sentences. Write this as a concise executive summary a CRO could read in 15 seconds. What is the real state of this opportunity? What is the buyer actually telling us between the lines? Be specific — reference names, timelines, and concrete details from the conversation.]

## RECOMMENDED NEXT MOVES
1. [HIGHEST PRIORITY — specific action with exact language/talk track to use. Include who should do what, by when, and the desired outcome.]
2. [SECOND PRIORITY — specific tactical action with context on why it matters now.]
3. [THIRD PRIORITY — strategic action to de-risk the engagement or accelerate timeline.]
4. [FOURTH PRIORITY — optional but recommended if there's a clear fourth move.]

## DRAFT FOLLOW-UP EMAIL
Subject: [Compelling, specific subject line that references something from the conversation — not generic]

[Professional email body, 120-180 words. Reference specific points discussed. Include a clear next step or ask. Write in the rep's voice — warm but direct. End with a specific CTA, not a vague "let me know".]

Best regards,
[Rep Name]`;

  // Build Claude messages from the conversation
  const claudeMessages = [
    ...chatMsgs.map(m => ({
      role: m.role === 'assistant' ? 'assistant' : 'user',
      content: m.content
    })),
    { role: 'user', content: debriefPrompt }
  ];

  const res = await fetch(DEBRIEF_ENDPOINT, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      system: systemMsg ? systemMsg.content + '\n\nYou are now generating the post-session debrief. Be specific, actionable, and reference actual details from the conversation.' : '',
      messages: claudeMessages,
      max_tokens: 2000
    })
  });

  if (!res.ok) { const e = await res.json().catch(()=>({})); throw new Error(e.error?.message||`Error ${res.status}`); }
  const data = await res.json();
  return data.content;
}

// ── Icons ────────────────────────────────────────────────────────
const ic=(d,w=16,h=16)=><svg width={w} height={h} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{d}</svg>;
const Ic={
  mic:ic(<><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></>),
  stop:<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>,
  send:ic(<><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></>,13,13),
  copy:ic(<><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></>,11,11),
  clip:ic(<><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/></>),
  upload:ic(<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></>,26,26),
  file:ic(<><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></>),
  x:ic(<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>,13,13),
  alert:ic(<><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></>),
  chart:ic(<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>),
  target:ic(<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>),
  mail:ic(<><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></>),
  msg:ic(<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>),
  hp:ic(<><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></>),
  zap:ic(<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>),
  shield:ic(<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>),
  check:ic(<polyline points="20 6 9 17 4 12"/>,12,12),
  refresh:ic(<><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></>),
  arrow:ic(<><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></>),
  sq:ic(<rect x="3" y="3" width="18" height="18" rx="2"/>),
};
const Logo=({h=24})=><svg viewBox="0 0 220 50" xmlns="http://www.w3.org/2000/svg" style={{height:h,width:'auto'}}><defs><linearGradient id="la" x1="0%" y1="100%" x2="50%" y2="0%"><stop offset="0%" stopColor="#5A79CA"/><stop offset="100%" stopColor="#8B6DB3"/></linearGradient><linearGradient id="lb" x1="50%" y1="100%" x2="100%" y2="0%"><stop offset="0%" stopColor="#C06E85"/><stop offset="100%" stopColor="#D4856A"/></linearGradient></defs><g transform="translate(2,3)"><path d="M4 38 L18 6 L26 30 Z" fill="url(#la)" opacity=".85"/><path d="M22 30 L30 6 L44 38 Z" fill="url(#lb)" opacity=".75"/></g><text x="58" y="37" fontFamily="Inter,sans-serif" fontWeight="800" fontSize="30" letterSpacing="-0.5" fill="#fff">mantyl</text></svg>;
const Mark=({s=14})=><svg viewBox="0 0 48 44" fill="none" style={{width:s,height:s}}><defs><linearGradient id="ma" x1="0%" y1="100%" x2="50%" y2="0%"><stop offset="0%" stopColor="#5A79CA"/><stop offset="100%" stopColor="#8B6DB3"/></linearGradient><linearGradient id="mb" x1="50%" y1="100%" x2="100%" y2="0%"><stop offset="0%" stopColor="#C06E85"/><stop offset="100%" stopColor="#D4856A"/></linearGradient></defs><path d="M4 38 L18 6 L26 30 Z" fill="url(#ma)" opacity=".85"/><path d="M22 30 L30 6 L44 38 Z" fill="url(#mb)" opacity=".75"/></svg>;

// ── APP ──────────────────────────────────────────────────────────
function App(){
  const[step,setStep]=useState('setup');
  const[email,setEmail]=useState('');
  const[name,setName]=useState('');
  const[prospect,setProspect]=useState('');
  const[stage,setStage]=useState('');
  const[ctx,setCtx]=useState('');
  const[files,setFiles]=useState([]);
  const[fc,setFc]=useState('');
  const[msgs,setMsgs]=useState([]);
  const[tx,setTx]=useState([]);
  const[hear,setHear]=useState(false);
  const[talk,setTalk]=useState(false);
  const[think,setThink]=useState(false);
  const[err,setErr]=useState(null);
  const[brief,setBrief]=useState('');
  const[briefing,setBriefing]=useState(false);
  const[ti,setTi]=useState('');
  const[cid,setCid]=useState(null);
  const[fe,setFe]=useState({});

  const rr=useRef(null),sr=useRef(null),mr=useRef(msgs),audioRef=useRef(null);
  useEffect(()=>{mr.current=msgs},[msgs]);
  useEffect(()=>{sr.current?.scrollIntoView({behavior:'smooth'})},[tx]);


  const addF=useCallback(nf=>{const a=Array.from(nf);setFiles(p=>[...p,...a]);a.forEach(f=>{const r=new FileReader();r.onload=e=>setFc(p=>p+`\n\n--- ${f.name} ---\n${e.target.result}`);r.readAsText(f)})},[]);
  const rmF=i=>setFiles(p=>p.filter((_,x)=>x!==i));

  const validate=()=>{const e={};if(!email.trim())e.email='Required';if(!name.trim())e.name='Required';if(!prospect.trim())e.prospect='Required';if(!stage)e.stage='Required';setFe(e);return !Object.keys(e).length};

  const start=async()=>{
    if(!validate())return;
    setErr(null);
    let c=`Session Context:\nRep: ${name}\nEmail: ${email}\nProspect/Account: ${prospect}\nStage: ${stage}\n`;
    if(ctx)c+=`Notes: ${ctx}\n`;
    if(fc)c+=`\nDocuments:${fc}\n`;
    const s={role:'system',content:SYS+'\n\n'+c};
    setMsgs([s]);setTx([]);setStep('session');
    try{
      const g=await ask([s,{role:'user',content:`Session started. I'm ${name}. I want to talk about my engagement with ${prospect}. We're in ${stage}. Acknowledge what you know, then ask your first question.`}]);
      setMsgs(p=>[...p,{role:'user',content:'[Session started]'},{role:'assistant',content:g}]);
      setTx(p=>[...p,{role:'s',text:g}]);
      say(g);
    }catch(e){setErr(e.message);setStep('setup')}
  };

  // ElevenLabs TTS — Sophie's voice (warm, professional female)
  // Falls back to Web Speech API if TTS endpoint fails
  const say=async t=>{
    // Stop any currently playing audio
    if(audioRef.current){audioRef.current.pause();audioRef.current=null}
    setTalk(true);
    try{
      const res=await fetch(TTS_ENDPOINT,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({text:t,voice:'shimmer',speed:1.05})
      });
      if(!res.ok)throw new Error('TTS failed');
      const data=await res.json();
      const audio=new Audio('data:audio/mp3;base64,'+data.audio);
      audioRef.current=audio;
      audio.onended=()=>{setTalk(false);audioRef.current=null};
      audio.onerror=()=>{setTalk(false);audioRef.current=null};
      await audio.play();
    }catch(e){
      // Fallback to Web Speech API
      const sy=window.speechSynthesis;
      if(!sy){setTalk(false);return}
      sy.cancel();
      const u=new SpeechSynthesisUtterance(t);
      const v=sy.getVoices();
      const pk=v.find(x=>x.name.includes('Samantha'))||v.find(x=>x.name.includes('Karen'))||v.find(x=>x.lang.startsWith('en')&&x.name.includes('Google'))||v.find(x=>x.lang.startsWith('en'));
      if(pk)u.voice=pk;u.rate=1;u.pitch=1.05;
      u.onstart=()=>setTalk(true);u.onend=()=>setTalk(false);u.onerror=()=>setTalk(false);
      sy.speak(u);
    }
  };

  const listen=()=>{if(!('webkitSpeechRecognition' in window||'SpeechRecognition' in window)){setErr('Speech not supported — use Chrome or type below.');return}const S=window.SpeechRecognition||window.webkitSpeechRecognition;const r=new S();r.continuous=false;r.interimResults=false;r.lang='en-US';r.onstart=()=>setHear(true);r.onresult=e=>{setHear(false);send(e.results[0][0].transcript)};r.onerror=e=>{setHear(false);if(e.error!=='no-speech')setErr(`Mic: ${e.error}`)};r.onend=()=>setHear(false);if(audioRef.current){audioRef.current.pause();audioRef.current=null}window.speechSynthesis?.cancel();setTalk(false);r.start();rr.current=r};
  const unlisten=()=>{rr.current?.stop();setHear(false)};

  const send=async t=>{if(!t.trim())return;const u=[...mr.current,{role:'user',content:t}];setMsgs(u);setTx(p=>[...p,{role:'u',text:t}]);setThink(true);try{const r=await ask(u);setMsgs(p=>[...p,{role:'assistant',content:r}]);setTx(p=>[...p,{role:'s',text:r}]);say(r)}catch(e){setErr(e.message)}finally{setThink(false)}};
  const sub=e=>{e.preventDefault();if(!ti.trim())return;send(ti);setTi('')};

  const end=async()=>{if(audioRef.current){audioRef.current.pause();audioRef.current=null}window.speechSynthesis?.cancel();rr.current?.stop();setHear(false);setTalk(false);setStep('debrief');setBriefing(true);try{setBrief(await genDebrief(mr.current))}catch(e){setBrief('Error: '+e.message)}finally{setBriefing(false)}};

  const cp=(t,id)=>{navigator.clipboard.writeText(t);setCid(id);setTimeout(()=>setCid(null),2e3)};
  const reset=()=>{setStep('setup');setMsgs([]);setTx([]);setBrief('');setErr(null);setFiles([]);setFc('');setCtx('');setTi('')};

  // Enhanced parser — extracts structured data for executive rendering
  const ps=t=>{
    const s={raw:t,risk:'yellow',signals:[],diagnosis:'',moves:[],emailSubject:'',emailBody:''};
    t.split(/^## /m).filter(Boolean).forEach(p=>{
      const l=p.split('\n'),tt=l[0].trim(),b=l.slice(1).join('\n').trim();
      if(tt.includes('SIGNAL')||tt.includes('SYNOPSIS')){
        // Extract risk level
        const rm=b.match(/Risk\s*Level[:\s]*(\w+)/i);
        if(rm)s.risk=rm[1].toLowerCase();
        // Extract bullet signals
        const bullets=b.match(/^[-*]\s+(.+)$/gm);
        if(bullets)s.signals=bullets.map(x=>x.replace(/^[-*]\s+/,'').trim());
        // Extract diagnosis
        const dm=b.match(/Diagnosis[:\s]*(.+(?:\n(?![-*\n#]).+)*)/i);
        if(dm)s.diagnosis=dm[1].trim();
        else{const lines=b.split('\n').filter(x=>!x.match(/^[-*]/)&&!x.match(/Risk\s*Level/i)&&!x.match(/Key\s*Signals/i)&&x.trim());s.diagnosis=lines.join(' ').trim()}
        s.synopsis=b;
      }else if(tt.includes('NEXT')||tt.includes('MOVE')||tt.includes('ACTION')){
        const items=b.match(/^\d+\.\s*(.+(?:\n(?!\d+\.).+)*)/gm);
        if(items)s.moves=items.map(x=>x.replace(/^\d+\.\s*/,'').trim());
        s.actions=b;
      }else if(tt.includes('EMAIL')||tt.includes('FOLLOW')||tt.includes('MESSAGE')){
        const sm=b.match(/Subject[:\s]*(.+)/i);
        if(sm)s.emailSubject=sm[1].trim();
        // Email body is everything after Subject line
        const bodyStart=b.indexOf('\n',b.search(/Subject/i));
        if(bodyStart>-1)s.emailBody=b.slice(bodyStart).trim();
        else s.emailBody=b;
        s.email=b;
      }
    });
    return s;
  };
  const sec=brief?ps(brief):{raw:'',risk:'yellow',signals:[],diagnosis:'',moves:[],emailSubject:'',emailBody:''};
  const [showTx,setShowTx]=useState(false);

  return(<div>
    <header className="hdr"><div className="hdr-l"><a href="https://mantyl.ai" target="_blank" rel="noopener noreferrer"><Logo h={24}/></a><div className="hdr-div"/><span className="hdr-name">Sophie</span></div><div className="hdr-r"><span className="hdr-pill"><span className="hdr-dot"/>AI Agent</span><a href={CAL} target="_blank" rel="noopener noreferrer" className="hdr-cta">Book Now</a></div></header>

    {/* HERO */}
    <section className="hero">
      <div className="hero-grid"/>
      <div className="hero-fade"/>
      {/* Ambient particles */}
      <div className="hero-particle hp-1"/><div className="hero-particle hp-2"/><div className="hero-particle hp-3"/>
      <div className="hero-particle hp-4"/><div className="hero-particle hp-5"/><div className="hero-particle hp-6"/>
      <div className="hero-wrap">
        <div className="hero-left">
          <div className="hero-eyebrow"><div className="hero-tag"><span className="hero-tag-dot"/>AI Sales Analyst</div></div>
          <h1 className="hero-h1">Meet <em>Sophie</em> — your<br/>voice-powered sales analyst.</h1>
          <p className="hero-p">Upload your notes, talk through the opportunity, and walk away with a signal report, next moves, and a ready-to-send follow-up. All in under five minutes.</p>
          <div className="hero-stats">
            <div className="hero-stat"><span className="hero-stat-num">30s</span><span className="hero-stat-label">Setup</span></div>
            <div className="hero-stat"><span className="hero-stat-num">5 min</span><span className="hero-stat-label">Avg. session</span></div>
            <div className="hero-stat"><span className="hero-stat-num">3</span><span className="hero-stat-label">Deliverables</span></div>
          </div>
        </div>
        <div className="hero-right">
          <div className="sophie-showcase">
            <div className="sophie-bg"/>
            <div className="sophie-ring"/>
            <div className="sophie-ring-2"/>
            <SophiePortrait w={320}/>
          </div>
          <div className="insight-card ic-1"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#6B8ADB" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg><div><div className="insight-card-text">Signal detected</div><div className="insight-card-sub">Timeline avoidance</div></div></div>
          <div className="insight-card ic-2"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#D4849A" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><div><div className="insight-card-text">Risk analysis</div><div className="insight-card-sub">Single-threaded</div></div></div>
          <div className="insight-card ic-3"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#E89E6C" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><div><div className="insight-card-text">Follow-up ready</div><div className="insight-card-sub">Auto-drafted</div></div></div>
        </div>
      </div>
    </section>

    {/* Steps */}
    <div className="steps">
      <div className={`step ${step==='setup'?'on':'done'}`}><span className="step-n">{step!=='setup'?Ic.check:'1'}</span>Load Context</div>
      <div className={`step-line ${step!=='setup'?'dn':''}`}/>
      <div className={`step ${step==='session'?'on':step==='debrief'?'done':''}`}><span className="step-n">{step==='debrief'?Ic.check:'2'}</span>Talk to Sophie</div>
      <div className={`step-line ${step==='debrief'?'dn':''}`}/>
      <div className={`step ${step==='debrief'?'on':''}`}><span className="step-n">3</span>Debrief</div>
    </div>

    <main className={`mn ${step==='debrief'?'wide':''}`}>
      {err&&<div className="err-b fi-a">{Ic.alert}<span>{err}</span></div>}

      {step==='setup'&&<div className="fi-a">
        <div className="card">
          <div className="card-t" style={{color:'var(--lav)'}}>{Ic.clip}Session Context</div>
          <div className="fg">
            <div className={`fi ${fe.name?'err':''}`}><label>Your Name <span className="req">*</span></label><input placeholder="e.g. Sarah Chen" value={name} onChange={e=>{setName(e.target.value);setFe(p=>({...p,name:null}))}}/>{fe.name&&<span className="ferr">{fe.name}</span>}</div>
            <div className={`fi ${fe.email?'err':''}`}><label>Email <span className="req">*</span></label><input type="email" placeholder="you@company.com" value={email} onChange={e=>{setEmail(e.target.value);setFe(p=>({...p,email:null}))}}/>{fe.email&&<span className="ferr">{fe.email}</span>}</div>
            <div className={`fi ${fe.prospect?'err':''}`}><label>Prospect / Account <span className="req">*</span></label><input placeholder="e.g. Acme Corp — Sarah Johnson" value={prospect} onChange={e=>{setProspect(e.target.value);setFe(p=>({...p,prospect:null}))}}/>{fe.prospect&&<span className="ferr">{fe.prospect}</span>}</div>
            <div className={`fi ${fe.stage?'err':''}`}><label>Current Stage <span className="req">*</span></label><select value={stage} onChange={e=>{setStage(e.target.value);setFe(p=>({...p,stage:null}))}}><option value="">Select stage...</option><option>Discovery / Qualification</option><option>Demo / Evaluation</option><option>Proposal / Negotiation</option><option>Contract / Legal Review</option><option>Closed Won — Onboarding</option><option>At Risk / Stalled</option></select>{fe.stage&&<span className="ferr">{fe.stage}</span>}</div>
            <div className="fi fw"><label>Quick Notes</label><textarea rows={3} placeholder="What happened? Key objections? Anything Sophie should know..." value={ctx} onChange={e=>setCtx(e.target.value)}/></div>
          </div>
        </div>

        <div className="card">
          <div className="card-t" style={{color:'var(--rose)'}}>{Ic.file}Upload Documents <span style={{fontSize:11,fontWeight:400,color:'#94a3b8',marginLeft:6}}>Optional</span></div>
          <div className="uz" onDragOver={e=>{e.preventDefault();e.currentTarget.classList.add('dg')}} onDragLeave={e=>e.currentTarget.classList.remove('dg')} onDrop={e=>{e.preventDefault();e.currentTarget.classList.remove('dg');addF(e.dataTransfer.files)}} onClick={()=>{const i=document.createElement('input');i.type='file';i.multiple=true;i.accept='.txt,.md,.csv,.json,.log';i.onchange=e=>addF(e.target.files);i.click()}}>
            {Ic.upload}<div className="uz-t">Drop files or click to browse</div><div className="uz-h">Call notes, CRM exports, emails (.txt, .md, .csv)</div>
          </div>
          {files.length>0&&<div className="uf">{files.map((f,i)=><div key={i} className="uf-i"><span style={{color:'var(--blue)'}}>{Ic.file}</span><span className="uf-n">{f.name}</span><span className="uf-s">{(f.size/1024).toFixed(1)}KB</span><button className="uf-x" onClick={e=>{e.stopPropagation();rmF(i)}}>{Ic.x}</button></div>)}</div>}
        </div>

        <button className="go-btn" onClick={start}>{Ic.hp} Start Session with Sophie</button>

        <div className="cta"><div className="cta-l"><span className="cta-m">M</span><div><div className="cta-tt">Want this built for your team?</div><div className="cta-dd">Custom AI tools tailored to your CRM, playbook, and workflow.</div></div></div><a href={CAL} target="_blank" rel="noopener noreferrer" className="cta-b">Book a Call</a></div>
      </div>}

      {step==='session'&&<div className="vs fi-a">
        {/* Ambient particles */}
        <div className="vs-particle vp-1"/><div className="vs-particle vp-2"/>
        <div className="vs-particle vp-3"/><div className="vs-particle vp-4"/>

        {/* Session header */}
        <div className="vs-header">
          <div className="vs-header-left">
            <Mark s={16}/>
            <span className="vs-header-name">Sophie</span>
            <div className="vs-header-tag"><span className="vs-header-dot"/>Live Session</div>
          </div>
          <button className="end-btn" onClick={end}>{Ic.sq}<span>End & Get Report</span></button>
        </div>

        {/* Main body — Sophie left, conversation right */}
        <div className="vs-body">
          {/* Left — Sophie with animated AI orb */}
          <div className={`vs-left ${hear||talk?'active':''} ${talk?'speaking':''}`}>
            <div className="ai-orb-container">
              {/* The gradient orb — morphs based on state */}
              <div className={`ai-orb ${hear?'li':talk?'sp':think?'th':''}`}/>
              <div className="ai-orb-inner"/>
              {/* Pulse rings */}
              <div className="ai-pulse-ring"/>
              <div className="ai-pulse-ring r2"/>
              <div className="ai-pulse-ring r3"/>
              {/* Sophie image */}
              <img src="sophie.png" alt="Sophie" className="vs-sophie"/>
            </div>

            {/* Status indicator */}
            <div className="vs-status">
              <span className={`vs-status-dot ${hear?'listening':talk?'speaking':think?'thinking':'idle'}`}/>
              {hear?'Listening...':talk?'Sophie is speaking...':think?'Analyzing...':'Ready'}
            </div>

            {/* Waveform visualizer */}
            <div className="vs-wave">
              {[...Array(13)].map((_,i)=><div key={i} className={`vs-wave-bar ${hear||talk?'active':''}`}/>)}
            </div>
          </div>

          {/* Right — Conversation thread */}
          <div className="vs-right">
            <div className="vs-transcript">
              {tx.length===0&&<div className="vs-tx-empty">Your conversation with Sophie will appear here...</div>}
              {tx.map((m,i)=><div key={i} className={`vs-msg ${m.role==='s'?'sophie-msg':'user-msg'}`}>
                <div className={`vs-msg-avatar ${m.role==='s'?'sophie':'user'}`}>
                  {m.role==='s'?<img src="sophie.png" alt="S"/>:name[0]?.toUpperCase()||'Y'}
                </div>
                <div className="vs-msg-body">
                  <div className="vs-msg-name">{m.role==='s'?'Sophie':name||'You'}</div>
                  <div className="vs-msg-text">{m.text}</div>
                </div>
              </div>)}
              {think&&<div className="vs-msg sophie-msg">
                <div className="vs-msg-avatar sophie"><img src="sophie.png" alt="S"/></div>
                <div className="vs-msg-body">
                  <div className="vs-msg-name">Sophie</div>
                  <div className="vs-thinking"><div className="thk-dots"><span/><span/><span/></div>Thinking...</div>
                </div>
              </div>}
              <div ref={sr}/>
            </div>

            {/* Controls */}
            <div className="vs-controls">
              <div className="vs-controls-row">
                <div className={`mic-label ${hear?'recording-label':''}`}>
                  {hear?<><strong>Listening...</strong><br/>Press to stop</>:talk?<><strong>Sophie is speaking</strong><br/>Wait to respond</>:<><strong>Press to talk</strong><br/>with Sophie</>}
                </div>
                <button className={`mic-btn ${hear?'recording':'idle'}`} onClick={hear?unlisten:listen} disabled={think||talk}>
                  {hear?Ic.stop:Ic.mic}
                </button>
                <button className="end-btn" onClick={end} title="End conversation and get your debrief">{Ic.sq}<span>End & Get Report</span></button>
              </div>
              <div className="vs-exit-hint">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                Press "End & Get Report" when you're done to receive your signal report, next moves, and follow-up email.
              </div>
            </div>

            {/* Divider — or type instead */}
            <div className="vs-input-divider">
              <div className="vs-input-divider-line"/>
              <span className="vs-input-divider-text">or type instead</span>
              <div className="vs-input-divider-line"/>
            </div>

            {/* Text input alternative */}
            <form className="vs-input" onSubmit={sub} style={{marginTop:4}}>
              <input placeholder="Type your message to Sophie..." value={ti} onChange={e=>setTi(e.target.value)} disabled={think}/>
              <button type="submit" disabled={think||!ti.trim()}>{Ic.send}Send</button>
            </form>
          </div>
        </div>
      </div>}

      {step==='debrief'&&<div className="db fi-a">
        {briefing?<div className="db-loading">
          <Mark s={40}/>
          <div className="db-loading-text">Sophie is analyzing your conversation</div>
          <div className="db-loading-sub">Generating signal report, next moves, and follow-up email...</div>
          <div className="db-loading-dots"><span/><span/><span/></div>
        </div>:<>
          {/* ── Executive Header ── */}
          <div className="db-hero">
            <div className="db-hero-top">
              <div>
                <div className="db-hero-title">Session Debrief — <em>{prospect||'Prospect'}</em></div>
                <div className="db-hero-sub">Prepared by Sophie for {name} on {new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}</div>
              </div>
              <div className="db-hero-actions">
                <button className="db-hero-btn secondary" onClick={()=>cp(brief,'all')}>{Ic.copy}{cid==='all'?'Copied':'Copy All'}</button>
                <button className="db-hero-btn primary" onClick={reset}>{Ic.refresh}New Session</button>
              </div>
            </div>
            <div className="db-meta">
              <div className="db-meta-item">
                <div className="db-meta-label">Account</div>
                <div className="db-meta-value">{prospect||'—'}</div>
              </div>
              <div className="db-meta-item">
                <div className="db-meta-label">Stage</div>
                <div className="db-meta-value sm">{stage||'—'}</div>
              </div>
              <div className="db-meta-item">
                <div className="db-meta-label">Exchanges</div>
                <div className="db-meta-value">{tx.length}</div>
              </div>
              <div className="db-meta-item">
                <div className="db-meta-label">Risk Level</div>
                <div className="db-meta-value">
                  <span className={`risk-badge ${sec.risk}`}><span className="risk-dot"/>{sec.risk.toUpperCase()}</span>
                </div>
              </div>
            </div>
          </div>

          {/* ── Signal Report ── */}
          {(sec.signals.length>0||sec.diagnosis)&&<div className="db-section accent-blue">
            <div className="db-sh">
              <div className="db-sh-left">
                <div className="db-sh-icon blue">{Ic.chart}</div>
                <div className="db-sh-text"><h3>Signal Report</h3><p>Key findings from the conversation</p></div>
              </div>
              <div className="db-sh-right">
                <button className={`cp ${cid==='s'?'ok':''}`} onClick={()=>cp(sec.synopsis||'','s')}>{Ic.copy}{cid==='s'?'Copied':'Copy'}</button>
              </div>
            </div>
            <div className="db-sb">
              {sec.signals.length>0&&<ul className="db-findings">{sec.signals.map((s,i)=><li key={i}>{s}</li>)}</ul>}
              {sec.diagnosis&&<div className="db-diagnosis"><strong>Diagnosis:</strong> {sec.diagnosis}</div>}
            </div>
          </div>}

          {/* ── Recommended Next Moves ── */}
          {sec.moves.length>0&&<div className="db-section accent-lav">
            <div className="db-sh">
              <div className="db-sh-left">
                <div className="db-sh-icon lav">{Ic.target}</div>
                <div className="db-sh-text"><h3>Recommended Next Moves</h3><p>Prioritized actions to advance this opportunity</p></div>
              </div>
              <div className="db-sh-right">
                <button className={`cp ${cid==='a'?'ok':''}`} onClick={()=>cp(sec.actions||'','a')}>{Ic.copy}{cid==='a'?'Copied':'Copy'}</button>
              </div>
            </div>
            <div className="db-sb">
              <ol className="db-moves">{sec.moves.map((m,i)=><li key={i}><span>{m}</span></li>)}</ol>
            </div>
          </div>}

          {/* ── Draft Follow-Up Email ── */}
          {(sec.emailSubject||sec.emailBody)&&<div className="db-section accent-rose">
            <div className="db-sh">
              <div className="db-sh-left">
                <div className="db-sh-icon rose">{Ic.mail}</div>
                <div className="db-sh-text"><h3>Draft Follow-Up Email</h3><p>Ready to review, personalize, and send</p></div>
              </div>
              <div className="db-sh-right">
                <button className={`cp ${cid==='e'?'ok':''}`} onClick={()=>cp(sec.email||'','e')}>{Ic.copy}{cid==='e'?'Copied':'Copy'}</button>
              </div>
            </div>
            <div className="db-sb">
              <div className="db-email">
                {sec.emailSubject&&<div className="db-email-header">
                  <div className="db-email-row"><span className="db-email-label">To</span><span className="db-email-val">{prospect||'Prospect'}</span></div>
                  <div className="db-email-row"><span className="db-email-label">Subject</span><span className="db-email-val" style={{fontWeight:600}}>{sec.emailSubject}</span></div>
                </div>}
                <div className="db-email-body">{sec.emailBody}</div>
              </div>
            </div>
          </div>}

          {/* ── Fallback if parsing failed ── */}
          {!sec.signals.length&&!sec.moves.length&&!sec.emailBody&&brief&&<div className="db-section accent-navy">
            <div className="db-sh">
              <div className="db-sh-left">
                <div className="db-sh-icon navy">{Ic.clip}</div>
                <div className="db-sh-text"><h3>Full Debrief</h3><p>Complete analysis from Sophie</p></div>
              </div>
              <div className="db-sh-right">
                <button className={`cp ${cid==='f'?'ok':''}`} onClick={()=>cp(brief,'f')}>{Ic.copy}{cid==='f'?'Copied':'Copy'}</button>
              </div>
            </div>
            <div className="db-sb"><p style={{whiteSpace:'pre-wrap',lineHeight:1.8}}>{brief}</p></div>
          </div>}

          {/* ── Conversation Transcript (collapsible) ── */}
          <div className="db-section accent-navy">
            <div className="db-sh">
              <div className="db-sh-left">
                <div className="db-sh-icon navy">{Ic.msg}</div>
                <div className="db-sh-text"><h3>Conversation Transcript</h3><p>{tx.length} exchanges between {name||'you'} and Sophie</p></div>
              </div>
              <div className="db-sh-right">
                <button className={`cp ${cid==='t'?'ok':''}`} onClick={()=>cp(tx.map(m=>`${m.role==='s'?'Sophie':name}: ${m.text}`).join('\n\n'),'t')}>{Ic.copy}{cid==='t'?'Copied':'Copy'}</button>
              </div>
            </div>
            {showTx&&<div className="db-transcript">
              {tx.map((m,i)=><div key={i} className="db-tx-msg">
                <div className={`db-tx-avatar ${m.role==='s'?'sophie':'user'}`}>
                  {m.role==='s'?<img src="sophie.png" alt="S"/>:name[0]?.toUpperCase()||'Y'}
                </div>
                <div className="db-tx-body">
                  <div className="db-tx-name">{m.role==='s'?'Sophie':name||'You'}</div>
                  <div className="db-tx-text">{m.text}</div>
                </div>
              </div>)}
            </div>}
            <button className={`db-collapse-btn ${showTx?'open':''}`} onClick={()=>setShowTx(!showTx)}>
              <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
              {showTx?'Hide Transcript':`Show Full Transcript (${tx.length} messages)`}
            </button>
          </div>

          {/* ── Action Footer ── */}
          <div className="db-actions">
            <button className="da-btn primary" onClick={reset}>{Ic.refresh}Start New Session</button>
            <button className="da-btn secondary" onClick={()=>setStep('session')}>{Ic.arrow}Back to Conversation</button>
            <button className="da-btn secondary" onClick={()=>{window.open(CAL,'_blank')}}>{Ic.zap}Book a Consultation</button>
          </div>
        </>}
      </div>}
    </main>
    <footer className="ft"><div className="ft-i"><Mark s={12}/>Powered by <a href="https://mantyl.ai" target="_blank" rel="noopener noreferrer">mantyl.ai</a></div></footer>
  </div>)
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
